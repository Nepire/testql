#!/bin/sh /etc/rc.common

START=99
STOP=21

export PROCLINE="/usr/sbin/securitypage -c /etc/config/securitypage/securitycenter.conf"
export PROC_USE_CGROUP_PATH="/dev/cgroup/net_cls/limited/tasks;/dev/cgroup/mem/group1/tasks"

ENABELTAG="/etc/config/securitypage/enable.tag"

start() {
	rm -rf /userdisk/appdata/app_infos/2882303761517300515.manifest
        rm -rf /userdisk/appdata/2882303761517300515/
        rm -rf /userdisk/appdata/2882303761517300515.flashed

	rm -rf /userdisk/appdata/app_infos/2882303761517280998.manifest
        rm -rf /userdisk/appdata/2882303761517280998/
        rm -rf /userdisk/appdata/2882303761517280998.flashed

	if [ -f $ENABELTAG ];
	then
	  echo "security page enabled."
	else
	  return 0
	fi
	 
	uci set rule_mgr.switch.tencent_security=1; uci commit
	/etc/init.d/rule_mgr start
	echo 1 > /proc/sys/net/ipv4/http_security_switch

	/usr/sbin/supervisord start
	return $?
}

restart() {
	stop
	sleep 1
	start
	return $?
}

shutdown() {
	stop
	return $?
}

stop() {
	uci set rule_mgr.switch.tencent_security=0; uci commit
	/etc/init.d/rule_mgr stop
	echo 0 > /proc/sys/net/ipv4/http_security_switch

	/usr/sbin/supervisord stop
	return $?
}

status() {
	/usr/sbin/supervisord status
	return $?
}
#
